
## Polygenic basis for adaptive morphological variation in a threatened Aotearoa | New Zealand bird, the hihi (*Notiomystis cincta*)


#### Genotyping and pedigree data
Of the 58 466 SNPs included on a costum array, 45 553 markers were designated as polymorphic high resolution according to the default quality control metrics in the Axiom Analysis Suite software. PLINK filtering (--maf 0.01, --hwe 1e-20) resulted in the removal of 325 and 69 loci among the autosomes, respectively. Two thousand seven hundred and thirty-four SNPs appeared as duplicates (i.e. mapped to the same chromosome at the same position) and hence only one SNP from each position was retained. To avoid population structure as a confounding factor, we only included birds from Tiritiri Matangi Island in this study, which shows no structure (electronic supplementary material, figure S1). No individual was removed due to low genotyping rates (--mind), but some were excluded for having incomplete phenotypic information. The final dataset contained 39 699 autosomal genomic loci, with a mean call rate of 0.997398, and complete sex and phenotype information on all three traits for 523 birds.

#### Trait heritabilities
We employed several different methods of retrieving heritability estimates for our three traits under investigation, using generalized linear mixed models (an ‘animal model’ and either the pedigree relatedness or the relatedness estimated from the genotyped markers (i.e. the GRM). First, pedigree- and GRM-based heritabilities (h2ped, h2GRM1) were estimated in a Bayesian framework using the R package MCMCglmm. To estimate h2ped, we fitted the relatedness matrix calculated from the full pedigree. To estimate h2GRM1, the GRM was constructed using an approach that scales by the actual variance in relatedness. Following de Villemereuil, the additive genetic variance (VA) for each trait was estimated by fitting sex and clutch size as fixed effects and accounting for the random effects of mother, social father, year and month when the nestling was born. Models were run for 503 000 iterations with a burn-in period of 3000, sampling every 10th output from the chain, and convergence checked graphically and using the Heidelberger and Welch convergence test. The heritability was then calculated as the ratio of VA to VP (total phenotypic variance), where VP and thus h2 accounts for the variance explained by fixed effects.

Furthermore, to be able to compare our results with the heritability of morphological traits reported in other avian studies, we also used the ‘prefitModel’ function in the R package RepeatABEL. While RepeatABEL is mainly known for allowing the inclusion of repeated measures, it was chosen as it allows the inclusion of multiple random effects into the model. The GRM-based heritability (h2GRM2) was estimated by fitting the same fixed and random effects as above.

Finally, the package BayesR was used to infer the phenotypic variation explained by SNPs in different effect size distributions and to estimate the SNP-based heritability (h2BayesR). The SNP-based heritability differs from the GRM-based heritability as it estimates the proportion of variance accounted for by linear regression on a set of genotyped SNPs. As BayesR does not allow for the inclusion of any fixed or random effects, the raw phenotypes were corrected for those effects in MCMCglmm (same model as for the heritability analysis, but excluding VA) and the residuals then used as phenotypes in BayesR. We set the mean effect sizes of 0.01, 0.001, 0.0001 or 0 for the four mixture distributions and ran the programme for 50 000 iterations, with a burn-in of 20 000, recording every 10th sample in the chain after that (as suggested in the default settings).

#### Chromosome partitioning of genetic variance
For each chromosome, we estimated the contribution to overall trait variance by fitting a mixed model in MCMCglmm with a GRM estimated from markers on the focal chromosome, a GRM calculated from all other markers in the genome, and accounting for sex, clutch size, mother, social father, year and month of birth. As above, the GRMs were calculated using an approach that scales by the actual variance in relatedness. We ran 203 000 iterations with a burn-in period of 3000, sampling every 10th output from the chain. Owing to convergence issues for chromosomes with fewer than 850 markers, we merged multiple chromosomes based on their size according to the zebra finch karyotypes (electronic supplementary material, table S1). The variance was estimated individually for chromosomes 1–14, 1A and 20 and each merged chromosome group.

We also used GCTA (V1.24) to estimate the variance explained by each chromosome. GRMs were generated with the --make-grm option for each individual chromosome and all but the focal chromosome. Because the model failed to converge when fitting all autosomes simultaneously, we fitted the GRM pairs (e.g. GRM for Chr 1 and GRM for all but Chr 1, using the --mgrm option) in the default REML model one by one to estimate the additive genetic variance explained by each chromosome. Both pathways, however, should theoretically result in the same heritability estimate per autosomal chromosome [48]. Fixed effects included sex and clutch size, and we adjusted for population stratification using the --qcovar function on the top 10 principal components.

For both methods, we used the cor.test function in R to test the significance of a positive Pearson's correlation between chromosome size (based on the zebra finch genome) and variance explained. To account for p-value inflation as a result of heteroscedasticity and censoring, we used 100 000 permutations to calculate corrected p-values following the approach of Kemppainen & Husby.

#### Genome-wide association scan
To test for association between trait and genotype, we used the RepeatABEL package. The ‘prefitModel’ function first fits a model without the SNP effects and computes the variance components for the trait, using the hglm package. SNPs are then tested for association by accounting for these random effects in the ‘rGLS’ function in RepeatABEL, using the same fixed and random effects as in the heritability analysis. p-values for each SNP are computed using the Wald statistics, together with the SNP effect for each marker. We used a Bonferroni correction to control for family-wise error rate from multiple testing (significance value of 0.05 divided by the number of markers, giving a critical p-value of 1.26 × 10−6). All genomic SNPs were tested for association, including those that mapped to random or the Unknown zebra finch chromosomes, or were not mapped to a zebra finch chromosome (which we combine as ‘chromosome 77’; electronic supplementary material, table S1). SNPs of interest were further investigated based on the zebra finch genome annotation in the Ensembl database (version 100.12: bTaeGut1_v1.p). In addition, we calculated the genomic inflation factor (λ, computed using the lower 90% of the distribution), to determine whether population structure was likely to have led to inflation of the test statistics.
